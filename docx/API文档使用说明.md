# ğŸ‰ API æ–‡æ¡£å·²æˆåŠŸé…ç½®ï¼

## âœ… é…ç½®å®Œæˆ

ä½ çš„ API æ–‡æ¡£å·²ç»æˆåŠŸç”Ÿæˆå¹¶å¯ä»¥è®¿é—®äº†ï¼

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è®¿é—® Swagger UI æ–‡æ¡£

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼š

```
http://localhost:3000/api-docs
```

ä½ ä¼šçœ‹åˆ°å¦‚ä¸‹ç•Œé¢ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  My Node Server API                                 v1.0.0  â”‚
â”‚  åŸºäº Express + TypeScript + MongoDB çš„åç«¯ API æ–‡æ¡£        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  ğŸ” Authentication (è®¤è¯æ¥å£)                                â”‚
â”‚    POST /api/backend/auth/LoginAuther     ç”¨æˆ·ç™»å½•          â”‚
â”‚    POST /api/backend/auth/Register        ç”¨æˆ·æ³¨å†Œ          â”‚
â”‚                                                              â”‚
â”‚  ğŸ‘¥ Users (ç”¨æˆ·ç®¡ç†æ¥å£)                                     â”‚
â”‚    GET    /api/backend/user/              è·å–æ‰€æœ‰ç”¨æˆ·  ğŸ”’  â”‚
â”‚    GET    /api/backend/user/getUserId     æ ¹æ®IDè·å–    ğŸ”’  â”‚
â”‚    POST   /api/backend/user/CreateUser    åˆ›å»ºç”¨æˆ·      ğŸ”’  â”‚
â”‚    PUT    /api/backend/user/updataUser    æ›´æ–°ç”¨æˆ·      ğŸ”’  â”‚
â”‚    DELETE /api/backend/user/deleteUser    åˆ é™¤ç”¨æˆ·      ğŸ”’  â”‚
â”‚                                                              â”‚
â”‚  ğŸ’š Health (å¥åº·æ£€æŸ¥)                                        â”‚
â”‚    GET /api/                              APIåŸºæœ¬ä¿¡æ¯       â”‚
â”‚    GET /health                            æœåŠ¡å™¨çŠ¶æ€         â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Swagger UI åŠŸèƒ½ç‰¹ç‚¹

### 1ï¸âƒ£ æŸ¥çœ‹æ¥å£è¯¦æƒ…

ç‚¹å‡»ä»»æ„æ¥å£å¯ä»¥æŸ¥çœ‹ï¼š
- **è¯·æ±‚å‚æ•°**ï¼šå­—æ®µåã€ç±»å‹ã€æ˜¯å¦å¿…å¡«ã€ç¤ºä¾‹å€¼
- **å“åº”ç¤ºä¾‹**ï¼šæˆåŠŸå’Œå¤±è´¥çš„å“åº”æ ¼å¼
- **çŠ¶æ€ç è¯´æ˜**ï¼š200ã€400ã€401ã€500 ç­‰

### 2ï¸âƒ£ åœ¨çº¿æµ‹è¯•æ¥å£

æ¯ä¸ªæ¥å£éƒ½æœ‰ **"Try it out"** æŒ‰é’®ï¼š

```
1. ç‚¹å‡» "Try it out"
   â†“
2. å¡«å†™è¯·æ±‚å‚æ•°
   â†“
3. ç‚¹å‡» "Execute"
   â†“
4. æŸ¥çœ‹å®æ—¶å“åº”ç»“æœ
```

### 3ï¸âƒ£ JWT è®¤è¯æµ‹è¯•

å¯¹äºéœ€è¦è®¤è¯çš„æ¥å£ï¼ˆæ ‡æœ‰ ğŸ”’ï¼‰ï¼š

```
1. å…ˆè°ƒç”¨ POST /api/backend/auth/LoginAuther ç™»å½•
   â†“
2. å¤åˆ¶è¿”å›çš„ token
   â†“
3. ç‚¹å‡»é¡µé¢å³ä¸Šè§’çš„ ğŸ”“ "Authorize" æŒ‰é’®
   â†“
4. è¾“å…¥ï¼šBearer <ä½ çš„token>
   â†“
5. ç‚¹å‡» "Authorize"
   â†“
6. ç°åœ¨å¯ä»¥æµ‹è¯•éœ€è¦è®¤è¯çš„æ¥å£äº†ï¼
```

---

## ğŸ“– æ–¹æ¡ˆå¯¹æ¯”

æˆ‘ä¸ºä½ å®ç°äº† **Swagger/OpenAPI** æ–¹æ¡ˆï¼Œè¿™æ˜¯ç›®å‰æœ€æµè¡Œçš„é€‰æ‹©ã€‚

### å„ç§ API æ–‡æ¡£æ–¹æ¡ˆå¯¹æ¯”ï¼š

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| **Swagger/OpenAPI** âœ… | â€¢ å¯è§†åŒ–ç•Œé¢æ¼‚äº®<br>â€¢ å¯åœ¨çº¿æµ‹è¯•<br>â€¢ æ”¯æŒå¯¼å‡ºåˆ°å…¶ä»–å·¥å…·<br>â€¢ ç¤¾åŒºç”Ÿæ€å¥½ | â€¢ éœ€è¦å†™æ³¨é‡Š | æ¨èç”¨äºå¯¹å¤– API |
| Postman Collection | â€¢ å‰ç«¯ç†Ÿæ‚‰çš„å·¥å…·<br>â€¢ å¯ä»¥å›¢é˜Ÿåä½œ | â€¢ éœ€è¦æ‰‹åŠ¨ç»´æŠ¤<br>â€¢ ä¸ä¸ä»£ç åŒæ­¥ | å›¢é˜Ÿå†…éƒ¨æµ‹è¯• |
| TypeDoc | â€¢ è‡ªåŠ¨ç”Ÿæˆ<br>â€¢ é€‚åˆ TypeScript | â€¢ ä¸é€‚åˆ REST API<br>â€¢ æ›´é€‚åˆåº“æ–‡æ¡£ | ä»£ç åº“æ–‡æ¡£ |
| API Blueprint | â€¢ Markdown è¯­æ³•<br>â€¢ æ˜“è¯»æ˜“å†™ | â€¢ ç”Ÿæ€è¾ƒå°<br>â€¢ å·¥å…·æ”¯æŒå°‘ | å°å‹é¡¹ç›® |
| æ‰‹å†™ Markdown | â€¢ å®Œå…¨è‡ªå®šä¹‰<br>â€¢ ç®€å•ç›´æ¥ | â€¢ éœ€è¦æ‰‹åŠ¨ç»´æŠ¤<br>â€¢ æ— æ³•æµ‹è¯• | ç®€å•é¡¹ç›® |

---

## ğŸ”§ å·²å®ç°çš„åŠŸèƒ½

### âœ… Swagger é…ç½®æ–‡ä»¶
- æ–‡ä»¶ï¼š`src/config/swagger.ts`
- å®šä¹‰äº† API åŸºæœ¬ä¿¡æ¯ã€æœåŠ¡å™¨åœ°å€ã€è®¤è¯æ–¹å¼
- é…ç½®äº†æ•°æ®æ¨¡å‹ï¼ˆUserã€Authã€Errorï¼‰

### âœ… API è·¯ç”±æ³¨é‡Š
å·²ä¸ºä»¥ä¸‹è·¯ç”±æ·»åŠ äº†è¯¦ç»†çš„ Swagger æ³¨é‡Šï¼š

#### è®¤è¯æ¥å£ (`src/routes/backend/auth.ts`)
- `POST /api/backend/auth/LoginAuther` - ç”¨æˆ·ç™»å½•
- `POST /api/backend/auth/Register` - ç”¨æˆ·æ³¨å†Œ

#### ç”¨æˆ·æ¥å£ (`src/routes/backend/users.ts`)
- `GET /api/backend/user/` - è·å–æ‰€æœ‰ç”¨æˆ·
- `GET /api/backend/user/getUserId` - æ ¹æ®IDè·å–ç”¨æˆ·
- `POST /api/backend/user/CreateUser` - åˆ›å»ºç”¨æˆ·
- `PUT /api/backend/user/updataUser` - æ›´æ–°ç”¨æˆ·
- `DELETE /api/backend/user/deleteUser` - åˆ é™¤ç”¨æˆ·

#### å¥åº·æ£€æŸ¥ (`src/routes/api.ts`)
- `GET /api/` - API åŸºæœ¬ä¿¡æ¯

### âœ… é›†æˆåˆ°åº”ç”¨
- åœ¨ `src/app.ts` ä¸­å¼•å…¥å¹¶å¯åŠ¨ Swagger UI
- è®¿é—®åœ°å€ï¼šhttp://localhost:3000/api-docs
- JSON æ ¼å¼ï¼šhttp://localhost:3000/api-docs.json

---

## ğŸ“¤ å¯¼å‡ºåˆ°å…¶ä»–å·¥å…·

### å¯¼å…¥åˆ° Postman

1. æ‰“å¼€ Postman
2. ç‚¹å‡» **Import** â†’ **Link**
3. è¾“å…¥ï¼š`http://localhost:3000/api-docs.json`
4. ç‚¹å‡» **Continue** â†’ **Import**

### å¯¼å…¥åˆ° Insomnia

1. æ‰“å¼€ Insomnia
2. **Create** â†’ **Import From** â†’ **URL**
3. è¾“å…¥ï¼š`http://localhost:3000/api-docs.json`

### å¯¼å…¥åˆ° Apifoxï¼ˆå›½äº§ï¼Œæ¨èï¼‰

1. æ‰“å¼€ Apifox
2. æ–°å»ºé¡¹ç›® â†’ **å¯¼å…¥æ•°æ®**
3. é€‰æ‹© **URLå¯¼å…¥**
4. è¾“å…¥ï¼š`http://localhost:3000/api-docs.json`

---

## ğŸ¨ Swagger æ³¨é‡Šè¯­æ³•

å¦‚æœä½ è¦æ·»åŠ æ–°çš„æ¥å£ï¼ŒæŒ‰ç…§è¿™ä¸ªæ¨¡æ¿å†™æ³¨é‡Šï¼š

```typescript
/**
 * @swagger
 * /api/your-endpoint:
 *   post:
 *     summary: æ¥å£ç®€ä»‹
 *     tags: [æ ‡ç­¾å]
 *     description: è¯¦ç»†æè¿°
 *     security:
 *       - bearerAuth: []  # å¦‚æœéœ€è¦è®¤è¯
 *     requestBody:
 *       required: true
 *       content:
 *         application/json:
 *           schema:
 *             type: object
 *             properties:
 *               fieldName:
 *                 type: string
 *                 example: "ç¤ºä¾‹å€¼"
 *     responses:
 *       200:
 *         description: æˆåŠŸ
 *       400:
 *         description: å¤±è´¥
 */
router.post("/your-endpoint", controller.method);
```

---

## ğŸ’¡ å®é™…å¼€å‘æµç¨‹

### å‰ç«¯å¼€å‘è€…ä½¿ç”¨æ–‡æ¡£çš„å…¸å‹æµç¨‹ï¼š

```
1. è®¿é—® http://localhost:3000/api-docs
   â†“
2. æ‰¾åˆ°éœ€è¦çš„æ¥å£ï¼ˆæ¯”å¦‚"è·å–ç”¨æˆ·åˆ—è¡¨"ï¼‰
   â†“
3. æŸ¥çœ‹è¯·æ±‚å‚æ•°å’Œå“åº”æ ¼å¼
   â†“
4. ç‚¹å‡» "Try it out" åœ¨çº¿æµ‹è¯•
   â†“
5. ç¡®è®¤æ¥å£æ­£å¸¸å·¥ä½œåï¼Œåœ¨å‰ç«¯ä»£ç ä¸­è°ƒç”¨
   â†“
6. å¦‚æœéœ€è¦ï¼Œå¯¼å‡ºåˆ° Postman/Apifox ä¿å­˜
```

### ç¤ºä¾‹ï¼šå‰ç«¯è°ƒç”¨ä»£ç 

```javascript
// 1. ç™»å½•è·å– token
const loginResponse = await fetch('http://localhost:3000/api/backend/auth/LoginAuther', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    userName: 'john',
    email: 'john@example.com',
    password: '123456'
  })
});
const { token } = await loginResponse.json();

// 2. ä½¿ç”¨ token è·å–ç”¨æˆ·åˆ—è¡¨
const usersResponse = await fetch('http://localhost:3000/api/backend/user/', {
  headers: {
    'Authorization': `Bearer ${token}`
  }
});
const users = await usersResponse.json();
console.log(users);
```

---

## ğŸš§ åç»­å¯ä»¥æ”¹è¿›çš„åœ°æ–¹

1. **æ·»åŠ è¯·æ±‚å‚æ•°éªŒè¯**
   - ä½¿ç”¨ `express-validator` æˆ– `joi` éªŒè¯è¯·æ±‚å‚æ•°
   - åœ¨æ–‡æ¡£ä¸­ä½“ç°éªŒè¯è§„åˆ™

2. **å®Œå–„ JWT ä¸­é—´ä»¶**
   - å®ç° `src/middleware/JWTToken.ts`
   - åœ¨éœ€è¦è®¤è¯çš„è·¯ç”±ä¸Šåº”ç”¨ä¸­é—´ä»¶

3. **æ·»åŠ æ›´å¤šç¤ºä¾‹**
   - åœ¨ Swagger æ³¨é‡Šä¸­æ·»åŠ æ›´å¤šçš„è¯·æ±‚/å“åº”ç¤ºä¾‹
   - æ·»åŠ é”™è¯¯å¤„ç†çš„ç¤ºä¾‹

4. **ç‰ˆæœ¬æ§åˆ¶**
   - æ”¯æŒ API ç‰ˆæœ¬ç®¡ç†ï¼ˆv1, v2ï¼‰
   - åœ¨æ–‡æ¡£ä¸­åŒºåˆ†ä¸åŒç‰ˆæœ¬

5. **è‡ªåŠ¨åŒ–æµ‹è¯•**
   - åŸºäº OpenAPI è§„èŒƒç”Ÿæˆè‡ªåŠ¨åŒ–æµ‹è¯•
   - ç¡®ä¿æ–‡æ¡£å’Œå®é™…æ¥å£ä¸€è‡´

---

## ğŸ“š ç›¸å…³èµ„æº

- [Swagger å®˜æ–¹æ–‡æ¡£](https://swagger.io/docs/)
- [OpenAPI è§„èŒƒ](https://spec.openapis.org/oas/latest.html)
- [Swagger UI å®šåˆ¶](https://swagger.io/docs/open-source-tools/swagger-ui/usage/configuration/)

---

## âœ¨ æ€»ç»“

ç°åœ¨ä½ çš„ API å·²ç»æœ‰å®Œæ•´çš„æ–‡æ¡£äº†ï¼ä½œä¸ºå‰ç«¯å¼€å‘è€…ï¼Œä½ å¯ä»¥ï¼š

âœ… **åœ¨ Swagger UI ä¸­æŸ¥çœ‹æ‰€æœ‰æ¥å£**  
âœ… **åœ¨çº¿æµ‹è¯•æ¥å£ï¼Œæ— éœ€å†™ä»£ç **  
âœ… **å¯¼å‡ºåˆ° Postman/Apifox ç­‰å·¥å…·**  
âœ… **ä¸å›¢é˜Ÿæˆå‘˜åˆ†äº«æ–‡æ¡£é“¾æ¥**  
âœ… **ç¡®ä¿å‰åç«¯æ¥å£çº¦å®šä¸€è‡´**

å¼€å§‹è®¿é—® http://localhost:3000/api-docs ä½“éªŒå§ï¼ğŸš€

